{
  "url": "https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-infrastructure-access/#_top",
  "title": "SSH with Access for Infrastructure (recommended) - Cloudflare Zero Trust docsYesNoYesNo",
  "keyword": "",
  "content": "Skip to content          Cloudflare Docs            Search            Products  Learning  Status  Support  Log in   GitHub X YouTube       Select theme    DarkLightAuto        \n\tStarlightThemeProvider.updatePickers();\n const r=\"starlight-theme\",o=e=>e===\"auto\"||e===\"dark\"||e===\"light\"?e:\"auto\",c=()=>o(typeof localStorage<\"u\"&&localStorage.getItem(r));function n(e){typeof localStorage<\"u\"&&localStorage.setItem(r,e===\"light\"||e===\"dark\"?e:\"\")}const l=()=>matchMedia(\"(prefers-color-scheme: light)\").matches?\"light\":\"dark\";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e===\"auto\"?l():e,n(e)}matchMedia(\"(prefers-color-scheme: light)\").addEventListener(\"change\",()=>{c()===\"auto\"&&t(\"auto\")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector(\"select\")?.addEventListener(\"change\",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define(\"starlight-theme-select\",s); class n extends HTMLElement{constructor(){super();const e=this.querySelector(\"select\");e&&e.addEventListener(\"change\",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)})}}customElements.define(\"starlight-lang-select\",n);           class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector(\"button\"),this.btn.addEventListener(\"click\",()=>this.toggleExpanded());const t=this.closest(\"nav\");t&&t.addEventListener(\"keyup\",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute(\"aria-expanded\",String(t)),document.body.toggleAttribute(\"data-mobile-menu-expanded\",t)}toggleExpanded(){this.setExpanded(this.getAttribute(\"aria-expanded\")!==\"true\")}closeOnEscape(t){t.code===\"Escape\"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define(\"starlight-menu-button\",s);              Cloudflare Zero Trust      \n\t\t(() => {\n\t\t\ttry {\n\t\t\t\tif (!matchMedia('(min-width: 50em)').matches) return;\n\t\t\t\t/** @type {HTMLElement | null} */\n\t\t\t\tconst target = document.querySelector('sl-sidebar-state-persist');\n\t\t\t\tconst state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');\n\t\t\t\tif (!target || !state || target.dataset.hash !== state.hash) return;\n\t\t\t\twindow._starlightScrollRestore = state.scroll;\n\t\t\t\tcustomElements.define(\n\t\t\t\t\t'sl-sidebar-restore',\n\t\t\t\t\tclass SidebarRestore extends HTMLElement {\n\t\t\t\t\t\tconnectedCallback() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst idx = parseInt(this.dataset.index || '');\n\t\t\t\t\t\t\t\tconst details = this.closest('details');\n\t\t\t\t\t\t\t\tif (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];\n\t\t\t\t\t\t\t} catch {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} catch {}\n\t\t})();\n\t     Overview     Get started        Implementation guides         Secure your Internet traffic and SaaS apps ↗     Replace your VPN ↗     Deploy Zero Trust Web Access ↗            Identity         Overview     One-time PIN login        Device posture         Overview        WARP client checks         Overview     Application check     Carbon Black     Client certificate     Device serial numbers     Device UUID     Disk encryption     Domain joined     File check     Firewall     OS version     Require Gateway     Require WARP     SentinelOne            Service providers         Overview     CrowdStrike     Kolide     Microsoft Endpoint Manager     SentinelOne     Tanium     Uptycs     Workspace ONE            Access integrations         Overview     Mutual TLS     Tanium                User management         Overview     Access groups     Session management     Seat management     SCIM provisioning         Service tokens        Authorization cookie         Overview     Validate JWTs     Application token     CORS            SSO integration         Overview     Generic OIDC     Generic SAML 2.0     Active Directory (SAML)     Amazon Cognito     AWS IAM (SAML)     Centrify     Centrify (SAML)     Citrix ADC (SAML)     Facebook     GitHub     Google     Google Workspace     JumpCloud (SAML)     Keycloak (SAML)     LinkedIn     Microsoft Entra ID     Okta     Okta (SAML)     OneLogin     OneLogin (SAML)     PingFederate     PingOne     PingOne (SAML)     Signed AuthN requests (SAML)     Yandex                Connections         Overview        Cloudflare Tunnel         Overview        Get started         Overview     Create a remotely-managed tunnel (dashboard)     Create a locally-managed tunnel (CLI)     Useful terms            Downloads         Overview     Update cloudflared     License     Copyrights            Configure a tunnel         Overview     Remotely-managed tunnel        Locally-managed tunnel         Overview     Configuration file        Run as a service         Overview     Linux     macOS     Windows         Useful commands     Tunnel permissions         Origin configuration     Tunnel run parameters            Deploy a tunnel         Overview     Tunnel with firewall     Tunnel availability and failover     System requirements        Environments         Overview     Ansible     AWS     Azure     GCP     Kubernetes     Terraform                Use cases         Overview        SSH         Overview     SSH with Access for Infrastructure New     Self-managed SSH keys     Browser-rendered SSH terminal     SSH with client-side cloudflared         RDP     SMB     gRPC            Private networks         Overview        Connect private networks         Overview     Private DNS     Virtual networks     Load balancing         Peer-to-peer connectivity        WARP Connector         Overview Beta     Site-to-Internet     Site-to-site     User-to-site     VPC deployments                Public hostnames         Overview     DNS records     Load balancing            Monitor tunnels         Overview     Logs     Notifications     Metrics            Troubleshoot tunnels         Overview     Private network connectivity     Common errors            Do more with Tunnel         Overview     Migrate legacy tunnels     Quick Tunnels                Connect devices         Overview        WARP         Overview     First-time setup        Download WARP         Overview     Update WARP     Migrate 1.1.1.1 app            User-side certificates         Overview     Install certificate using WARP     Install certificate manually     Deploy custom certificate            Deploy WARP         Overview        Managed deployment         Overview        Partners         Overview     Fleet     Hexnode     Intune     Jamf     JumpCloud     Kandji         Parameters     Connect WARP before Windows login     Switch between Zero Trust organizations         Manual deployment     Device enrollment permissions     WARP with firewall     WARP with legacy VPN            Configure WARP         Overview     Device profiles        WARP modes         Overview     Enable Device Information Only            WARP settings         Overview     Captive portal detection         Managed networks        Route traffic         Overview     Local Domain Fallback     Split Tunnels     WARP architecture         WARP sessions            Troubleshoot WARP         Overview     Common issues     Client errors     Diagnostic logs     Known limitations         Remove WARP            Agentless options         Overview        DNS            Locations         Add locations     DNS resolver IPs and hostnames         DNS over TLS (DoT)     DNS over HTTPS (DoH)         HTTP                    Applications         Overview        Add web applications         Overview        SaaS applications         Overview     Generic OIDC application Beta     Generic SAML application     Adobe Acrobat Sign     Area 1     Asana     Atlassian Cloud     AWS     Braintree     Coupa     Digicert     DocuSign     Dropbox     GitHub Enterprise Cloud     Google Cloud     Google Workspace     Grafana     Grafana Cloud     Greenhouse Recruiting     Hubspot     Ironclad     Jamf Pro     Miro     PagerDuty     Pingboard     Salesforce (OIDC)     Salesforce (SAML)     ServiceNow (OIDC)     ServiceNow (SAML)     Slack     Smartsheet     SparkPost     Tableau Cloud     Workday     Zendesk     Zoom         Self-hosted applications     Cloudflare dashboard SSO application            Non-HTTP applications         Overview     Add an infrastructure application New     Browser-rendered terminal        Client-side cloudflared         Overview     Enable automatic cloudflared authentication     Arbitrary TCP         Short-lived certificates (legacy)            Scan SaaS applications         Overview     Manage findings        Available integrations         Overview     Amazon Web Services (AWS) S3     Atlassian Confluence     Atlassian Jira     Bitbucket Cloud     Box     Dropbox     GitHub        Google Workspace         Overview     Google Drive     Gmail     Google Admin     Google Calendar            Microsoft 365         Overview     Admin Center     OneDrive     SharePoint     Outlook         Salesforce     ServiceNow     Slack         Scan for sensitive data     Troubleshoot integrations         Login page     Block page     Add bookmarks     App Launcher            Policies         Overview        Secure Web Gateway         Overview        Get started         DNS filtering     Network filtering     HTTP filtering            DNS policies         Overview     Common policies     Test DNS filtering     Timed DNS policies            Network policies         Overview     Common policies     Protocol detection     SSH proxy and command logs            HTTP policies         Overview     Common policies     TLS decryption     HTTP/3     Tenant control     AV scanning     File sandboxing     WebSocket traffic            Egress policies         Overview     Dedicated egress IPs         Resolver policies Beta     Global policies     Applications and app types     Domain categories     Identity-based policies     Block page     Order of enforcement     Lists     Proxy            Access         Overview     Manage Access policies     Require Purpose Justification     External Evaluation rules     Isolate self-hosted application     Application paths     Enforce MFA     Temporary authentication            Browser Isolation         Overview        Set up Browser Isolation         Get started     Clientless Web Isolation     Non-identity on-ramps         Isolation policies     Extensions     Accessibility     Browser Isolation with firewall     Known limitations            Data Loss Prevention         Overview        Scan HTTP traffic         Create DLP policies     Common policies     Logging options         Scan SaaS apps ↗        DLP profiles         Configure DLP profiles     Predefined profiles     Integration profiles     Profile settings         DLP datasets                Insights            Analytics         Shadow IT Discovery     Gateway analytics            Email monitoring         Overview     Search email     Phishing report     Phish submissions            Digital Experience Monitoring         Overview Beta     Fleet status        Tests         Overview     HTTP test     Traceroute test     View test results         Remote captures     Notifications            Logs         Overview     User logs     Access audit logs        Gateway activity logs         Overview     Manage PII         Tunnel audit logs     Posture logs     Logpush integration         Risk score            Email Security         Overview        Setup         Overview        Post-delivery deployment            API deployment         Overview     Set up with Microsoft 365            BCC/Journaling            BCC setup         Microsoft Exchange BCC setup            Journaling setup         Office 365 journaling setup     Manually add domains     Manage domains                        Directories         Overview        Manage Microsoft directories         Overview     Manage groups in your directory     Manage users in your directory         Manage Email Security directories            Detection settings         Overview     Allow policies     Blocked senders     Trusted domains     Impersonation registry     Additional detections         Auto-move events     PhishGuard     Outbound Data Loss Prevention (DLP)        Reference         How Email Security detects phish     Information about your domain     Dispositions and attributes                API and Terraform         Overview        Access API examples         Overview     Access group     Any valid service token     Authentication method     Common name     Country Code     Email     Email domain     Everyone     G Suite Group     GitHub™ Organization     IP range     Microsoft Entra Group     mTLS certificate     Okta Group     SAML Attribute     Service token            Gateway API examples         Overview     DNS policy     Network policy     HTTP policy         Scoped API tokens     Terraform         Reference architecture ↗     Tutorials     Account limits     Roles and permissions     Glossary        Changelog         Overview     Access     Browser Isolation     CASB     Cloudflare Tunnel     Data Loss Prevention     Digital Experience Monitoring     Email Security     Gateway     Risk score     Zero Trust WARP Client         FAQ       \n\t\t(() => {\n\t\t\tconst scroller = document.getElementById('starlight__sidebar');\n\t\t\tif (!window._starlightScrollRestore || !scroller) return;\n\t\t\tscroller.scrollTop = window._starlightScrollRestore;\n\t\t\tdelete window._starlightScrollRestore;\n\t\t})();\n\t        Products  Learning  Status  Support  Log in   GitHub X YouTube       Select theme    DarkLightAuto        \n\tStarlightThemeProvider.updatePickers();\n            const a=document.getElementById(\"starlight__sidebar\"),n=a?.querySelector(\"sl-sidebar-state-persist\"),o=\"sl-sidebar-state\",i=()=>{let t=[];const e=n?.dataset.hash||\"\";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||\"{}\");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener(\"click\",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest(\"summary\")?.closest(\"details\");if(!e)return;const s=e.querySelector(\"sl-sidebar-restore\"),r=parseInt(s?.dataset.index||\"\");isNaN(r)||l(!e.open,r)});addEventListener(\"visibilitychange\",()=>{document.visibilityState===\"hidden\"&&d()});addEventListener(\"pageHide\",d);    On this page    Overview     1. Connect the server to Cloudflare     2. Set up the client     3. Route private network IPs through WARP     4. Add a target     5. Add an infrastructure application     6. Configure SSH server     Generate a Cloudflare SSH CA     Save the public key     Modify your SSHD config     Restart your SSH server        7. Connect as a user     SSH command logs     Enable SSH command logging     Disable SSH command logging     View SSH logs        On this page   Overview     1. Connect the server to Cloudflare     2. Set up the client     3. Route private network IPs through WARP     4. Add a target     5. Add an infrastructure application     6. Configure SSH server     Generate a Cloudflare SSH CA     Save the public key     Modify your SSHD config     Restart your SSH server        7. Connect as a user     SSH command logs     Enable SSH command logging     Disable SSH command logging     View SSH logs            Was this helpful?   Yes      No        What did you like?     Accurate    Easy to understand    Solved my problem    Helped me decide to use the product    Other        What went wrong?     Hard to understand    Incorrect information    Missing the information    Other        Thank you for helping improve Cloudflare's documentation!                    Products        …       Cloudflare Zero Trust        Connections        Cloudflare Tunnel        Use cases        SSH        SSH with Access for Infrastructure (recommended)        {\"@context\":\"https://schema.org\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"item\":{\"@id\":\"/products/\",\"name\":\"Products\"}},{\"@type\":\"ListItem\",\"position\":2,\"item\":{\"@id\":\"/cloudflare-one/\",\"name\":\"Cloudflare Zero Trust\"}},{\"@type\":\"ListItem\",\"position\":3,\"item\":{\"@id\":\"/cloudflare-one/connections/\",\"name\":\"Connections\"}},{\"@type\":\"ListItem\",\"position\":4,\"item\":{\"@id\":\"/cloudflare-one/connections/connect-networks/\",\"name\":\"Cloudflare Tunnel\"}},{\"@type\":\"ListItem\",\"position\":5,\"item\":{\"@id\":\"/cloudflare-one/connections/connect-networks/use-cases/\",\"name\":\"Use cases\"}},{\"@type\":\"ListItem\",\"position\":6,\"item\":{\"@id\":\"/cloudflare-one/connections/connect-networks/use-cases/ssh/\",\"name\":\"SSH\"}},{\"@type\":\"ListItem\",\"position\":7,\"item\":{\"@id\":\"/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-infrastructure-access/\",\"name\":\"SSH with Access for Infrastructure (recommended)\"}}]} class t extends HTMLElement{constructor(){super(),this.isManualToggle=!1,this.breadcrumbs=null,this.mainBemClass=null,this.totalWidth=0,this.resizeObserver=null,this.handleTruncatedButtonClick=()=>{this.breadcrumbs?.classList.remove(\"is-truncated\"),this.isManualToggle=!0},this.mainBemClass=this.dataset.mainBemClass||null;const e=this.dataset.id;!(\"truncated\"in this.dataset)||!e||(this.breadcrumbs=document.getElementById(e),this.initializeCrumbs(),this.setupResizeObserver())}initializeCrumbs(){this.breadcrumbs?.querySelectorAll(`.${this.mainBemClass}__crumb`)?.forEach(s=>{this.totalWidth+=s.offsetWidth})}setupResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{e.forEach(s=>{this.checkOverflow(s.target.clientWidth)})}),this.breadcrumbs&&this.resizeObserver.observe(this.breadcrumbs)}connectedCallback(){this.showHiddenCrumbs()}disconnectedCallback(){this.resizeObserver&&this.breadcrumbs&&(this.resizeObserver.unobserve(this.breadcrumbs),this.resizeObserver.disconnect())}toggleTruncated(e){this.breadcrumbs?.classList.toggle(\"is-truncated\",e)}showHiddenCrumbs(){const e=this.breadcrumbs?.querySelector(`.${this.mainBemClass}__truncated-button`);e?.removeEventListener(\"click\",this.handleTruncatedButtonClick),e?.addEventListener(\"click\",this.handleTruncatedButtonClick.bind(this))}checkOverflow(e){const s=this.totalWidth>e&&!this.isManualToggle;this.toggleTruncated(s),s||(this.isManualToggle=!1)}}customElements.get(\"astro-breadcrumbs\")||customElements.define(\"astro-breadcrumbs\",t);SSH with Access for Infrastructure (recommended) New                             const L=\"starlight-image-zoom-zoomable\",w=window.requestIdleCallback??(y=>setTimeout(y,1));customElements.define(\"starlight-image-zoom\",class f extends HTMLElement{#t;#i=[];#o;#s=this.querySelector(\"template\");#e={image:\"starlight-image-zoom-image\",opened:\"starlight-image-zoom-opened\",source:\"starlight-image-zoom-source\",transition:\"starlight-image-zoom-transition\"};#r=\"zoomTransform\";static#u=!1;constructor(){super();const t=()=>{w(()=>{const e=[...document.querySelectorAll(L)];e.length!==0&&(this.#m(e),document.addEventListener(\"click\",this.#d),window.addEventListener(\"resize\",this.#a))})};window.addEventListener(\"DOMContentLoaded\",t,{once:!0}),document.addEventListener(\"astro:after-preparation\",()=>{document.removeEventListener(\"click\",this.#d),window.removeEventListener(\"resize\",this.#a)},{once:!0}),f.#u||=document.addEventListener(\"astro:after-swap\",t)===void 0}#m(t){for(const e of t){const n=e.querySelector(\"img\");n&&(this.#i.push(n),e.querySelector(\"button\")?.addEventListener(\"click\",i=>{i.stopPropagation(),this.#l(n)}))}}#d=({target:t})=>{if(!(t instanceof HTMLElement&&t.closest(\"figcaption\"))){if(this.#t){this.#n();return}t instanceof HTMLImageElement&&this.#i.includes(t)&&this.#l(t)}};#a=()=>{this.#n(!0)};#c=()=>{this.#n()};#p=t=>{t.preventDefault(),this.#n()};#l(t){if(!this.#s||this.#t)return;this.#o=document.activeElement;const e=document.createElement(\"div\");e.append(this.#s.content.cloneNode(!0));const n=e.querySelector(\"dialog\"),i=n?.querySelector(\"figure\");if(!n||!i)return;const r={overflow:document.body.style.overflow,width:document.body.style.width},d=document.body.clientWidth;document.body.style.overflow=\"hidden\",document.body.style.width=`${d}px`,document.querySelector(\"header\")?.style.setProperty(\"padding-inline-end\",`calc(var(--sl-nav-pad-x) + ${window.innerWidth-d}px)`);const s=this.#f(t);t.classList.add(this.#e.source),s.classList.add(this.#e.image),i.append(s),this.#w(t.getAttribute(\"alt\"),i),document.body.append(e),document.addEventListener(\"wheel\",this.#c,{once:!0}),n.addEventListener(\"cancel\",this.#p),n.showModal(),w(()=>{s.style.transform=\"\",document.body.classList.add(this.#e.opened)}),this.#t={body:r,dialog:n,image:t,zoomedImage:s}}#n(t=!1){if(window.removeEventListener(\"wheel\",this.#c),!this.#t)return;const{zoomedImage:e}=this.#t;e.style.transform=e.dataset[this.#r]??\"\",document.body.classList.add(this.#e.transition),document.body.classList.remove(this.#e.opened);const{matches:n}=window.matchMedia(\"(prefers-reduced-motion: reduce)\");t||n?this.#h():e.addEventListener(\"transitionend\",this.#h,{once:!0})}#h=()=>{if(!this.#t)return;const{dialog:t,image:e}=this.#t;document.body.classList.remove(this.#e.transition),e.classList.remove(this.#e.source),t.parentElement?.remove(),document.body.style.overflow=this.#t.body.overflow,document.body.style.width=this.#t.body.width,document.querySelector(\"header\")?.style.setProperty(\"padding-inline-end\",\"var(--sl-nav-pad-x)\"),this.#t=void 0,this.#o instanceof HTMLElement&&this.#o.focus()};#w(t,e){if(Object.hasOwn(this.dataset,\"hideCaption\")||(t=t?.trim()??\"\",t.length===0))return;const n=document.createElement(\"figcaption\");n.ariaHidden=\"true\",n.textContent=t,e.append(n)}#f(t){const e=t.getBoundingClientRect(),n=this.#y(t),i=n?window.innerWidth:t.naturalWidth,r=n?window.innerHeight:t.naturalHeight,d=Math.min(window.innerWidth,i),s=Math.min(window.innerHeight,r),l=Math.min(d/i,s/r),a=(n?window.innerWidth:t.naturalWidth)*l,c=(n?window.innerHeight:t.naturalHeight)*l,h=(window.innerHeight-c)/2,u=(window.innerWidth-a)/2,o=t.cloneNode(!0);o.removeAttribute(\"id\"),o.style.position=\"absolute\",o.style.width=`${a}px`,o.style.height=`${c}px`,o.style.top=`${h}px`,o.style.left=`${u}px`,o.style.transform=\"\";const m=e.width/a,p=e.height/c,g=(-u+(e.width-a)/2+e.left)/m,v=(-h+(e.height-c)/2+e.top)/p;return o.style.transform=`scale(${m}, ${p}) translate3d(${g}px, ${v}px, 0)`,o.dataset[this.#r]=o.style.transform,t.parentElement?.tagName===\"PICTURE\"&&t.currentSrc&&(o.src=t.currentSrc),o}#y(t){return t.currentSrc.toLowerCase().endsWith(\".svg\")}});  Access for Infrastructure uses the same deployment model as WARP-to-Tunnel but unlocks more granular policy options and command logging functionality.\nFurthermore, Access for Infrastructure replaces traditional SSH keys with short-lived certificates issued to your users based on the token generated by their Access login. In traditional models, users generate an SSH keypair and administrators grant access to individual SSH servers by deploying their users' public keys to those servers. These SSH keys can remain unchanged on these servers for months or years. Cloudflare Access removes the burden of managing SSH keys, while also improving security by replacing long-lived SSH keys with ephemeral SSH certificates.\n1. Connect the server to Cloudflare\n\n\nCreate a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.\n\n\nIn the Private Networks tab for the tunnel, enter the private IP address of your server (or a range that includes the server IP).\n\n\n2. Set up the client\nTo connect your devices to Cloudflare:\n\nDeploy the WARP client on your devices in Gateway with WARP mode.\nEnable the Gateway proxy for TCP.\nCreate device enrollment rules to determine which devices can enroll to your Zero Trust organization.\n\n3. Route private network IPs through WARP\nBy default, WARP excludes traffic bound for RFC 1918 space ↗, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.\n\n\nFirst, check whether your Split Tunnels mode is set to Exclude or Include mode.\n\n\nIf you are using Include mode, add your network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.\n\n\nIf you are using Exclude mode:\n\nDelete your network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.\nRe-add IP/CDIR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.\n\n\n\nBy tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.\n4. Add a target\nA target represents a single resource in your infrastructure (such as a server, Kubernetes cluster, database, or container) that users will connect to through Cloudflare. Targets are protocol-agnostic, meaning that you do not need to define a new target for each protocol that runs on the server.\nTo create a new target:\n      Dashboard     API     Terraform      \nIn Zero Trust ↗, go to Networks > Targets.\nSelect Add a target.\nIn Target hostname, enter a user-friendly name for the target resource. We recommend using the server hostname, for example production-server. The hostname does not need to be unique and can be reused for multiple targets. Hostnames are used to define the subset of targets included in an infrastructure application and are not used in DNS address resolution.\n Format restrictions\n \nCase insensitive\nContain no more than 253 characters\nContain only alphanumeric characters, -, or . (no spaces allowed)\nStart and end with an alphanumeric character\n \n\nIn IP addresses, enter the private IPv4 and/or IPv6 address of the target resource. If the IP address overlaps across multiple private networks, select the virtual network where the resource is located. This IP address and virtual network pairing is now assigned to this target and cannot be reused in another target by design.\nIP address requirements\nPublic IPs are not currently supported.\nThe IP address must be reachable through Cloudflare Tunnel.\nYou must input the full IP address. The selector in the UI does not do partial matches.\n\nSelect Add target.\n  \n\nCreate an API token with the following permissions:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTypeItemPermissionAccountZero TrustEdit\n\n\nMake a POST request to the Infrastructure Access Targets endpoint:\nTerminal windowcurl https://api.cloudflare.com/client/v4/accounts/{account_id}/infrastructure/targets \\--header \"Authorization: Bearer <API_TOKEN>\" \\--data '{  \"hostname\": \"infra-access-target\",  \"ip\": {    \"ipv4\": {      \"ip_addr\": \"187.26.29.249\",      \"virtual_network_id\": \"c77b744e-acc8-428f-9257-6878c046ed55\"    },    \"ipv6\": {      \"ip_addr\": \"64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0\",      \"virtual_network_id\": \"c77b744e-acc8-428f-9257-6878c046ed55\"    }  }}'\n\n  \n\nAdd the following permission to your cloudflare_api_token ↗:\n\nTeams Write\n\n\n\nConfigure the cloudflare_zero_trust_infrastructure_access_target ↗ resource:\nresource \"cloudflare_zero_trust_infrastructure_access_target\" \"infra-ssh-target\" {  account_id = var.cloudflare_account_id    hostname   = \"infra-access-target\"    ip = {      ipv4 = {        ip_addr = \"187.26.29.249\"        virtual_network_id = \"c77b744e-acc8-428f-9257-6878c046ed55\"      }      ipv6 = {        ip_addr = \"64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0\"        virtual_network_id = \"c77b744e-acc8-428f-9257-6878c046ed55\"      }    }}\n\n     \nNext, create an infrastructure application to secure the target.\n5. Add an infrastructure application\n\n(() => {\n\tclass StarlightTabsRestore extends HTMLElement {\n\t\tconnectedCallback() {\n\t\t\tconst starlightTabs = this.closest('starlight-tabs');\n\t\t\tif (!(starlightTabs instanceof HTMLElement) || typeof localStorage === 'undefined') return;\n\t\t\tconst syncKey = starlightTabs.dataset.syncKey;\n\t\t\tif (!syncKey) return;\n\t\t\tconst label = localStorage.getItem(`starlight-synced-tabs__${syncKey}`);\n\t\t\tif (!label) return;\n\t\t\tconst tabs = [...starlightTabs?.querySelectorAll('[role=\"tab\"]')];\n\t\t\tconst tabIndexToRestore = tabs.findIndex(\n\t\t\t\t(tab) => tab instanceof HTMLAnchorElement && tab.textContent?.trim() === label\n\t\t\t);\n\t\t\tconst panels = starlightTabs?.querySelectorAll(':scope > [role=\"tabpanel\"]');\n\t\t\tconst newTab = tabs[tabIndexToRestore];\n\t\t\tconst newPanel = panels[tabIndexToRestore];\n\t\t\tif (tabIndexToRestore < 1 || !newTab || !newPanel) return;\n\t\t\ttabs[0]?.setAttribute('aria-selected', 'false');\n\t\t\ttabs[0]?.setAttribute('tabindex', '-1');\n\t\t\tpanels?.[0]?.setAttribute('hidden', 'true');\n\t\t\tnewTab.removeAttribute('tabindex');\n\t\t\tnewTab.setAttribute('aria-selected', 'true');\n\t\t\tnewPanel.removeAttribute('hidden');\n\t\t}\n\t}\n\tcustomElements.define('starlight-tabs-restore', StarlightTabsRestore);\n})()\n      Dashboard     API     Terraform      \nIn Zero Trust ↗, go to Access > Applications.\nSelect Add an application.\nSelect Infrastructure.\nEnter any name for the application.\nIn Target criteria, select the target hostname(s) that will represent the application. The application definition will apply to all targets that share the selected hostname, including any targets added in the future.\nEnter the Protocol and Port that will be used to connect to the server.\n(Optional) If a protocol runs on more than one port, select Add new target criteria and reconfigure the same target hostname and protocol with a different port number.\nNoteAccess for Infrastructure only supports assigning one protocol per port. You can reuse a port/protocol pairing across infrastructure applications, but the port cannot be reassigned to another protocol.\n\nSelect Next.\nTo secure your targets, configure a policy that defines who can connect and how they can connect:\n\nEnter any name for your policy.\nCreate a rule that matches the users who are allowed to reach the targets. For more information, refer to Access policies and review the list of infrastructure policy selectors.\nIn Connection context, enter the UNIX usernames that users can log in as (for example, root or ec2-user).\n\n\nSelect Add application.\n  \n\nCreate an API token with the following permissions:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTypeItemPermissionAccountAccess: Apps & PoliciesEdit\n\n\nMake a POST request to the Access applications endpoint:\nTerminal windowcurl https://api.cloudflare.com/client/v4/accounts/{account_id}/access/apps \\--header \"Authorization: Bearer <API_TOKEN>\" \\--header \"Content-Type: application/json\" \\--data '{  \"name\": \"Example infrastructure app\",  \"type\": \"infrastructure\",  \"target_criteria\": [    {      \"target_attributes\": {        \"hostname\": [          \"infra-access-target\"        ]      },      \"port\": 22,      \"protocol\": \"SSH\"    }  ],  \"policies\": [    {      \"name\": \"Allow a specific email\",      \"decision\": \"allow\",      \"include\": [        {          \"email\": {            \"email\": \"jdoe@company.com\"          }        }      ],      \"connection_rules\": {        \"ssh\": {          \"usernames\": [            \"root\",            \"ec2-user\"          ]        }      }    }  ]}'\n\n  \n\nAdd the following permission to your cloudflare_api_token ↗:\n\nAccess: Apps and Policies Write\n\n\n\nUse the cloudflare_zero_trust_access_application ↗ resource to create an infrastructure application:\nresource \"cloudflare_zero_trust_access_application\" \"infra-app\" {  account_id = var.cloudflare_account_id  name       = \"Example infrastructure app\"  type       = \"infrastructure\"\n  target_criteria {    port     = 22    protocol = \"SSH\"    target_attributes {      name = \"hostname\"      values = [\"infra-access-target\"]    }  }}\n\n\nUse the cloudflare_zero_trust_access_policy ↗ resource to add an infrastructure policy to the application:\nresource \"cloudflare_zero_trust_access_policy\" \"infra-app-policy\" {  application_id = cloudflare_zero_trust_access_application.infra-app.id  account_id = var.cloudflare_account_id  name       = \"Allow a specific email\"  decision   = \"allow\"  precedence = 1\n  include {    email = [\"jdoe@company.com\"]  }\n  connection_rules {    ssh {      usernames = [\"root\", \"ec2-user\"]    }  }}\n\n     \nThe targets in this application are now secured by your infrastructure policies.\nNoteGateway network policies take precedence over infrastructure policies. For example, if you block port 22 for all users in Gateway, then no one can SSH over port 22 to your targets.\n6. Configure SSH server\nNext, configure your SSH server to trust the Cloudflare SSH CA. This allows Access to authenticate using short-lived certificates instead of traditional SSH keys.\nGenerate a Cloudflare SSH CA\nNoteOther short-lived CAs, such as those used to secure SSH servers behind Cloudflare Access, are incompatible with the Gateway SSH proxy. For SSH logging to work, you must create a new CA using the gateway_ca API endpoint.\nTo generate a Cloudflare SSH CA and get its public key:\n\n\nCreate an API token with the following permissions:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTypeItemPermissionAccountAccess: SSH AuditingEdit\n\n\nIf you have not yet generated a Cloudflare SSH CA, make a POST request to the Cloudflare API:\nTerminal windowcurl --request POST \\\"https://api.cloudflare.com/client/v4/accounts/{account_id}/access/gateway_ca\" \\--header \"Authorization: Bearer <API_TOKEN>\"\n\n\nIf you have already created a Cloudflare SSH CA or receive the error message access.api.error.gateway_ca_already_exists, make a GET request instead:\nTerminal windowcurl https://api.cloudflare.com/client/v4/accounts/{account_id}/access/gateway_ca \\--header \"Authorization: Bearer <API_TOKEN>\"\n\n\nCopy the public_key value returned in the response.\n\n\nSave the public key\n\n\nUse the following command to change directories to the SSH configuration directory on the remote target machine:\nTerminal windowcd /etc/ssh\n\n\nOnce there, you can use the following command to both generate the file and open a text editor to input/paste the public key.\nTerminal windowvim ca.pub\n\n\nIn the ca.pub file, paste the public key without any modifications.\nThe ca.pub file can hold multiple keys, listed one per line. Empty lines and comments starting with # are also allowed.\n\n\nSave the ca.pub file. In some systems, you may need to use the following command to force the file to save depending on your permissions:\nTerminal window:w !sudo tee %:q!\n\n\nModify your SSHD config\nThe following procedure makes two changes to the sshd_config file on the remote target machine. The first change requires that you uncomment a field already set in most default configurations; the second change adds a new field.\n\n\nWhile staying within the /etc/ssh directory on the remote machine, open the sshd_config file.\nTerminal windowvim /etc/ssh/sshd_config\n\n\nGo to the row named PubkeyAuthentication. In most default configurations, the row will appear commented out as follows:\n# PubkeyAuthentication yes\n\n\nRemove the # symbol to uncomment the line; keep the setting yes enabled.\n\n\nNext, add a new line below PubkeyAuthentication as follows:\nTrustedUserCAKeys /etc/ssh/ca.pub\nSave the file and quit the editor. You might need to use the following command again to save and exit.\n:w !sudo tee %:q!\n\n\nNoteFor certain distributions, such as Amazon Linux 1 (based on RHEL), the certificate file permissions must be set to 600. You can set file permissions with the following command:Terminal windowchmod 600 /etc/ssh/ca.pub\nRestart your SSH server\nOnce you have modified your SSHD configuration, restart the SSH service on the remote machine.\n      Debian/Ubuntu     CentOS/RHEL      For older Debian/Ubuntu versions:Terminal windowsudo service ssh restartFor newer Debian/Ubuntu versions:Terminal windowsudo systemctl restart ssh  For CentOS/RHEL 6 and older:Terminal windowsudo service sshd restartFor CentOS/RHEL 7 and newer:Terminal windowsudo systemctl restart sshd     \n7. Connect as a user\nUsers can use any SSH client to connect to the target, as long as they are logged into the WARP client on their device. If the target is located within a particular virtual network, ensure that the WARP client is connected to that virtual network before initiating the connection. Users do not need to modify any SSH configs on their device. For example, to SSH from a terminal:\nTerminal windowssh <username>@<target IP>\nSSH with Access for Infrastructure also supports scp and rsync commands. At this time, sftp is not supported.\nFor more information, refer to the Access for Infrastructure documentation.\nSSH command logs\nSSH command logs contain the actual SSH commands that a user ran on the target. These logs are encrypted using a public key provided by the customer and are not visible to Cloudflare.\nEnable SSH command logging\nTo log SSH commands, you will need to generate an HPKE key pair and upload the public key to Cloudflare.\n\n\nDownload ↗ the Cloudflare ssh-log-cli utility.\n\n\nUsing the ssh-log-cli utility, generate a public and private key pair.\nTerminal window./ssh-log-cli generate-key-pair -o sshkeyls\n.expressive-code:has(figure.code-output){margin-top:0 !important}.expressive-code .code-output .copy{display:none !important}.expressive-code .code-output > pre{border-top-width:0 !important;background:var(--sl-color-gray-6) !important}.expressive-code .code-output > pre > code{user-select:none;transition:opacity 0.5s ease}.expressive-code .code-output > pre > code:hover{cursor:default;opacity:0.5}README.md    ssh-log-cli    sshkey    sshkey.pub\nThis command outputs two files, an sshkey.pub public key and a matching sshkey private key.\n\n\nIn Zero Trust ↗, go to Settings > Network.\n\n\nIn SSH encryption public key, paste the contents of sshkey.pub and select Save. \n\n\nAll proxied SSH commands are immediately encrypted using this public key. The matching private key is required to view logs.\nDisable SSH command logging\nTo turn off SSH command logging, delete your uploaded public key:\n      Dashboard     API      \n\nIn Zero Trust ↗, go to Settings > Network > SSH encryption public key.\n\n\nSelect Remove.\n\n\nSelect Remove key to confirm.\n\nCloudflare will stop logging SSH commands to your targets, as well as any commands subject to Gateway Audit SSH policies.  To delete the SSH encryption public key using the API:Terminal windowcurl --request PUT https://api.cloudflare.com/client/v4/accounts/{account_id}/gateway/audit_ssh_settings \\--header \"X-Auth-Email: <EMAIL>\" \\--header \"X-Auth-Key: <API_KEY>\" \\--data '{  \"public_key\": \"\"}'     class r extends HTMLElement{static#e=new Map;#t;#n=\"starlight-synced-tabs__\";constructor(){super();const t=this.querySelector('[role=\"tablist\"]');if(this.tabs=[...t.querySelectorAll('[role=\"tab\"]')],this.panels=[...this.querySelectorAll(':scope > [role=\"tabpanel\"]')],this.#t=this.dataset.syncKey,this.#t){const i=r.#e.get(this.#t)??[];i.push(this),r.#e.set(this.#t,i)}this.tabs.forEach((i,c)=>{i.addEventListener(\"click\",e=>{e.preventDefault();const n=t.querySelector('[aria-selected=\"true\"]');e.currentTarget!==n&&this.switchTab(e.currentTarget,c)}),i.addEventListener(\"keydown\",e=>{const n=this.tabs.indexOf(e.currentTarget),s=e.key===\"ArrowLeft\"?n-1:e.key===\"ArrowRight\"?n+1:e.key===\"Home\"?0:e.key===\"End\"?this.tabs.length-1:null;s!==null&&this.tabs[s]&&(e.preventDefault(),this.switchTab(this.tabs[s],s))})})}switchTab(t,i,c=!0){if(!t)return;const e=c?this.getBoundingClientRect().top:0;this.tabs.forEach(s=>{s.setAttribute(\"aria-selected\",\"false\"),s.setAttribute(\"tabindex\",\"-1\")}),this.panels.forEach(s=>{s.hidden=!0});const n=this.panels[i];n&&(n.hidden=!1),t.removeAttribute(\"tabindex\"),t.setAttribute(\"aria-selected\",\"true\"),c&&(t.focus(),r.#r(this,t),window.scrollTo({top:window.scrollY+(this.getBoundingClientRect().top-e)}))}#i(t){!this.#t||typeof localStorage>\"u\"||localStorage.setItem(this.#n+this.#t,t)}static#r(t,i){const c=t.#t,e=r.#s(i);if(!c||!e)return;const n=r.#e.get(c);if(n){for(const s of n){if(s===t)continue;const a=s.tabs.findIndex(o=>r.#s(o)===e);a!==-1&&s.switchTab(s.tabs[a],a,!1)}t.#i(e)}}static#s(t){return t.textContent?.trim()}}customElements.define(\"starlight-tabs\",r);\nView SSH logs\nSSH command logs are not visible from the dashboard itself and must be exported and decrypted.\nTo manually retrieve logs:\n\nIn Zero Trust ↗, go to Logs > Access.\nSelect a user who was allowed to access the target.\nSelect Download to download the session's command log.\n\nTo decrypt the log, follow the instructions in the SSH Logging CLI repository ↗. In the following example, sshkey is the private key that matches the public key uploaded to Cloudflare.\nTerminal window./ssh-log-cli decrypt -i sshlog -k sshkey\nThis command outputs a sshlog-decrypted.zip file with the decrypted logs.\n\n     Was this helpful?   Yes      No        What did you like?     Accurate    Easy to understand    Solved my problem    Helped me decide to use the product    Other        What went wrong?     Hard to understand    Incorrect information    Missing the information    Other        Thank you for helping improve Cloudflare's documentation!    class r extends HTMLElement{connectedCallback(){const d={'[data-icon=\"material-symbols:thumb-up-outline-rounded\"]':\"#feedback-yes\",'[data-icon=\"material-symbols:thumb-down-outline-rounded\"]':\"#feedback-no\"},s=this.querySelector(\"#feedback-thumbs\"),o=this.querySelector(\"#feedback-thanks\");if(!(!s||!o))for(const[i,n]of Object.entries(d))this.querySelector(i)?.addEventListener(\"click\",()=>{s.classList.add(\"hidden\");const e=this.querySelector(n);if(!e)return;e.classList.remove(\"hidden\");const a=e.querySelector(\"form\");a&&a.addEventListener(\"submit\",async c=>{c.preventDefault();const t=new FormData(c.target);t.set(\"page\",window.location.pathname),t.set(\"option\",n.split(\"-\")[1]),fetch(\"https://feedback.developers.cloudflare.com\",{method:\"POST\",body:t}),e.classList.add(\"hidden\"),o.classList.remove(\"hidden\")})})}}customElements.define(\"feedback-prompt\",r);       Edit page          Cloudflare DashboardDiscordCommunityLearning CenterSupport Portal\n\t\t\t\tfunction OptanonWrapper() {}\n\t\t\t  Cookie Settings",
  "custom_id": "yJcUdDI0cCzEmoiWCmEQwHyRuAafIvQPp6bDMWJrIzNWpQruSAsL1VEOLkuatoc0"
}