{
  "url": "https://developers.cloudflare.com/learning-paths/secure-internet-traffic/understand-policies/order-of-enforcement/#_top",
  "title": "Order of enforcement - Cloudflare Learning PathsYesNoYesNo",
  "keyword": "",
  "content": "Skip to content          Cloudflare Docs            Search            Products  Learning  Status  Support  Log in   GitHub X YouTube       Select theme    DarkLightAuto        \n\tStarlightThemeProvider.updatePickers();\n const r=\"starlight-theme\",o=e=>e===\"auto\"||e===\"dark\"||e===\"light\"?e:\"auto\",c=()=>o(typeof localStorage<\"u\"&&localStorage.getItem(r));function n(e){typeof localStorage<\"u\"&&localStorage.setItem(r,e===\"light\"||e===\"dark\"?e:\"\")}const l=()=>matchMedia(\"(prefers-color-scheme: light)\").matches?\"light\":\"dark\";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e===\"auto\"?l():e,n(e)}matchMedia(\"(prefers-color-scheme: light)\").addEventListener(\"change\",()=>{c()===\"auto\"&&t(\"auto\")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector(\"select\")?.addEventListener(\"change\",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define(\"starlight-theme-select\",s); class n extends HTMLElement{constructor(){super();const e=this.querySelector(\"select\");e&&e.addEventListener(\"change\",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)})}}customElements.define(\"starlight-lang-select\",n);           class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector(\"button\"),this.btn.addEventListener(\"click\",()=>this.toggleExpanded());const t=this.closest(\"nav\");t&&t.addEventListener(\"keyup\",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute(\"aria-expanded\",String(t)),document.body.toggleAttribute(\"data-mobile-menu-expanded\",t)}toggleExpanded(){this.setExpanded(this.getAttribute(\"aria-expanded\")!==\"true\")}closeOnEscape(t){t.code===\"Escape\"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define(\"starlight-menu-button\",s);              Secure your Internet traffic and SaaS apps (Learning Paths)      \n\t\t(() => {\n\t\t\ttry {\n\t\t\t\tif (!matchMedia('(min-width: 50em)').matches) return;\n\t\t\t\t/** @type {HTMLElement | null} */\n\t\t\t\tconst target = document.querySelector('sl-sidebar-state-persist');\n\t\t\t\tconst state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');\n\t\t\t\tif (!target || !state || target.dataset.hash !== state.hash) return;\n\t\t\t\twindow._starlightScrollRestore = state.scroll;\n\t\t\t\tcustomElements.define(\n\t\t\t\t\t'sl-sidebar-restore',\n\t\t\t\t\tclass SidebarRestore extends HTMLElement {\n\t\t\t\t\t\tconnectedCallback() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst idx = parseInt(this.dataset.index || '');\n\t\t\t\t\t\t\t\tconst details = this.closest('details');\n\t\t\t\t\t\t\t\tif (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];\n\t\t\t\t\t\t\t} catch {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} catch {}\n\t\t})();\n\t        Overview         Overview     What security features does Cloudflare provide?            Get started with Zero Trust         Overview     Prerequisites     Create a Cloudflare account     Create a Zero Trust organization     Configure an identity provider            Connect devices and networks to Cloudflare         Overview     Choose an on-ramp     Download and install WARP     MDM deployment     Verify device connectivity            Configure the device agent         Overview     Define device enrollment permissions     Customize device profiles     Proxy traffic through Gateway     Define Split Tunnel settings     Resolve private DNS     Determine when to use PAC files            Understand and streamline policy creation         Overview     Order of enforcement     Create a list of IPs or domains     Use indicator feeds to improve security policies            Build DNS security policies         Overview     Create your first DNS policy     Create an allowlist or blocklist     Recommended DNS policies     Onboard DNS for a network     Test a policy            Build network security policies         Overview     Create your first network policy     Recommended network policies            Build HTTP security policies         Overview     Use TLS inspection     Create your first HTTP policy     Build Data Loss Prevention (DLP) policies     Configure Browser Isolation     Recommended HTTP policies            Control traffic egress with source IP anchoring and allowlisting         Overview     Source IP anchoring     Egress IP best practices     Use egress policies to deliver consistent egress IPs            Secure SaaS applications         Overview     SaaS security overview     Single sign-on front door controls     Layer security methods     Scan SaaS applications with Cloudflare CASB           \n\t\t(() => {\n\t\t\tconst scroller = document.getElementById('starlight__sidebar');\n\t\t\tif (!window._starlightScrollRestore || !scroller) return;\n\t\t\tscroller.scrollTop = window._starlightScrollRestore;\n\t\t\tdelete window._starlightScrollRestore;\n\t\t})();\n\t        Products  Learning  Status  Support  Log in   GitHub X YouTube       Select theme    DarkLightAuto        \n\tStarlightThemeProvider.updatePickers();\n            const a=document.getElementById(\"starlight__sidebar\"),n=a?.querySelector(\"sl-sidebar-state-persist\"),o=\"sl-sidebar-state\",i=()=>{let t=[];const e=n?.dataset.hash||\"\";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||\"{}\");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener(\"click\",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest(\"summary\")?.closest(\"details\");if(!e)return;const s=e.querySelector(\"sl-sidebar-restore\"),r=parseInt(s?.dataset.index||\"\");isNaN(r)||l(!e.open,r)});addEventListener(\"visibilitychange\",()=>{document.visibilityState===\"hidden\"&&d()});addEventListener(\"pageHide\",d);    On this page    Overview     Priority between policy builders     HTTP/3 traffic        Priority within a policy builder     DNS policies     Network policies     HTTP policies     Order of precedence        Example     On this page   Overview     Priority between policy builders     HTTP/3 traffic        Priority within a policy builder     DNS policies     Network policies     HTTP policies     Order of precedence        Example         Was this helpful?   Yes      No        What did you like?     Accurate    Easy to understand    Solved my problem    Helped me decide to use the product    Other        What went wrong?     Hard to understand    Incorrect information    Missing the information    Other        Thank you for helping improve Cloudflare's documentation!                    Products        â€¦       Learning Paths        Secure your Internet traffic and SaaS apps        Understand and streamline policy creation        Order of enforcement        {\"@context\":\"https://schema.org\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"item\":{\"@id\":\"/products/\",\"name\":\"Products\"}},{\"@type\":\"ListItem\",\"position\":2,\"item\":{\"@id\":\"/learning-paths/\",\"name\":\"Learning Paths\"}},{\"@type\":\"ListItem\",\"position\":3,\"item\":{\"@id\":\"/learning-paths/secure-internet-traffic/\",\"name\":\"Secure your Internet traffic and SaaS apps\"}},{\"@type\":\"ListItem\",\"position\":4,\"item\":{\"@id\":\"/learning-paths/secure-internet-traffic/understand-policies/\",\"name\":\"Understand and streamline policy creation\"}},{\"@type\":\"ListItem\",\"position\":5,\"item\":{\"@id\":\"/learning-paths/secure-internet-traffic/understand-policies/order-of-enforcement/\",\"name\":\"Order of enforcement\"}}]} class t extends HTMLElement{constructor(){super(),this.isManualToggle=!1,this.breadcrumbs=null,this.mainBemClass=null,this.totalWidth=0,this.resizeObserver=null,this.handleTruncatedButtonClick=()=>{this.breadcrumbs?.classList.remove(\"is-truncated\"),this.isManualToggle=!0},this.mainBemClass=this.dataset.mainBemClass||null;const e=this.dataset.id;!(\"truncated\"in this.dataset)||!e||(this.breadcrumbs=document.getElementById(e),this.initializeCrumbs(),this.setupResizeObserver())}initializeCrumbs(){this.breadcrumbs?.querySelectorAll(`.${this.mainBemClass}__crumb`)?.forEach(s=>{this.totalWidth+=s.offsetWidth})}setupResizeObserver(){this.resizeObserver=new ResizeObserver(e=>{e.forEach(s=>{this.checkOverflow(s.target.clientWidth)})}),this.breadcrumbs&&this.resizeObserver.observe(this.breadcrumbs)}connectedCallback(){this.showHiddenCrumbs()}disconnectedCallback(){this.resizeObserver&&this.breadcrumbs&&(this.resizeObserver.unobserve(this.breadcrumbs),this.resizeObserver.disconnect())}toggleTruncated(e){this.breadcrumbs?.classList.toggle(\"is-truncated\",e)}showHiddenCrumbs(){const e=this.breadcrumbs?.querySelector(`.${this.mainBemClass}__truncated-button`);e?.removeEventListener(\"click\",this.handleTruncatedButtonClick),e?.addEventListener(\"click\",this.handleTruncatedButtonClick.bind(this))}checkOverflow(e){const s=this.totalWidth>e&&!this.isManualToggle;this.toggleTruncated(s),s||(this.isManualToggle=!1)}}customElements.get(\"astro-breadcrumbs\")||customElements.define(\"astro-breadcrumbs\",t);Order of enforcement                             const L=\"starlight-image-zoom-zoomable\",w=window.requestIdleCallback??(y=>setTimeout(y,1));customElements.define(\"starlight-image-zoom\",class f extends HTMLElement{#t;#i=[];#o;#s=this.querySelector(\"template\");#e={image:\"starlight-image-zoom-image\",opened:\"starlight-image-zoom-opened\",source:\"starlight-image-zoom-source\",transition:\"starlight-image-zoom-transition\"};#r=\"zoomTransform\";static#u=!1;constructor(){super();const t=()=>{w(()=>{const e=[...document.querySelectorAll(L)];e.length!==0&&(this.#m(e),document.addEventListener(\"click\",this.#d),window.addEventListener(\"resize\",this.#a))})};window.addEventListener(\"DOMContentLoaded\",t,{once:!0}),document.addEventListener(\"astro:after-preparation\",()=>{document.removeEventListener(\"click\",this.#d),window.removeEventListener(\"resize\",this.#a)},{once:!0}),f.#u||=document.addEventListener(\"astro:after-swap\",t)===void 0}#m(t){for(const e of t){const n=e.querySelector(\"img\");n&&(this.#i.push(n),e.querySelector(\"button\")?.addEventListener(\"click\",i=>{i.stopPropagation(),this.#l(n)}))}}#d=({target:t})=>{if(!(t instanceof HTMLElement&&t.closest(\"figcaption\"))){if(this.#t){this.#n();return}t instanceof HTMLImageElement&&this.#i.includes(t)&&this.#l(t)}};#a=()=>{this.#n(!0)};#c=()=>{this.#n()};#p=t=>{t.preventDefault(),this.#n()};#l(t){if(!this.#s||this.#t)return;this.#o=document.activeElement;const e=document.createElement(\"div\");e.append(this.#s.content.cloneNode(!0));const n=e.querySelector(\"dialog\"),i=n?.querySelector(\"figure\");if(!n||!i)return;const r={overflow:document.body.style.overflow,width:document.body.style.width},d=document.body.clientWidth;document.body.style.overflow=\"hidden\",document.body.style.width=`${d}px`,document.querySelector(\"header\")?.style.setProperty(\"padding-inline-end\",`calc(var(--sl-nav-pad-x) + ${window.innerWidth-d}px)`);const s=this.#f(t);t.classList.add(this.#e.source),s.classList.add(this.#e.image),i.append(s),this.#w(t.getAttribute(\"alt\"),i),document.body.append(e),document.addEventListener(\"wheel\",this.#c,{once:!0}),n.addEventListener(\"cancel\",this.#p),n.showModal(),w(()=>{s.style.transform=\"\",document.body.classList.add(this.#e.opened)}),this.#t={body:r,dialog:n,image:t,zoomedImage:s}}#n(t=!1){if(window.removeEventListener(\"wheel\",this.#c),!this.#t)return;const{zoomedImage:e}=this.#t;e.style.transform=e.dataset[this.#r]??\"\",document.body.classList.add(this.#e.transition),document.body.classList.remove(this.#e.opened);const{matches:n}=window.matchMedia(\"(prefers-reduced-motion: reduce)\");t||n?this.#h():e.addEventListener(\"transitionend\",this.#h,{once:!0})}#h=()=>{if(!this.#t)return;const{dialog:t,image:e}=this.#t;document.body.classList.remove(this.#e.transition),e.classList.remove(this.#e.source),t.parentElement?.remove(),document.body.style.overflow=this.#t.body.overflow,document.body.style.width=this.#t.body.width,document.querySelector(\"header\")?.style.setProperty(\"padding-inline-end\",\"var(--sl-nav-pad-x)\"),this.#t=void 0,this.#o instanceof HTMLElement&&this.#o.focus()};#w(t,e){if(Object.hasOwn(this.dataset,\"hideCaption\")||(t=t?.trim()??\"\",t.length===0))return;const n=document.createElement(\"figcaption\");n.ariaHidden=\"true\",n.textContent=t,e.append(n)}#f(t){const e=t.getBoundingClientRect(),n=this.#y(t),i=n?window.innerWidth:t.naturalWidth,r=n?window.innerHeight:t.naturalHeight,d=Math.min(window.innerWidth,i),s=Math.min(window.innerHeight,r),l=Math.min(d/i,s/r),a=(n?window.innerWidth:t.naturalWidth)*l,c=(n?window.innerHeight:t.naturalHeight)*l,h=(window.innerHeight-c)/2,u=(window.innerWidth-a)/2,o=t.cloneNode(!0);o.removeAttribute(\"id\"),o.style.position=\"absolute\",o.style.width=`${a}px`,o.style.height=`${c}px`,o.style.top=`${h}px`,o.style.left=`${u}px`,o.style.transform=\"\";const m=e.width/a,p=e.height/c,g=(-u+(e.width-a)/2+e.left)/m,v=(-h+(e.height-c)/2+e.top)/p;return o.style.transform=`scale(${m}, ${p}) translate3d(${g}px, ${v}px, 0)`,o.dataset[this.#r]=o.style.transform,t.parentElement?.tagName===\"PICTURE\"&&t.currentSrc&&(o.src=t.currentSrc),o}#y(t){return t.currentSrc.toLowerCase().endsWith(\".svg\")}});  Gateway follows a specific order of enforcement as traffic travels through the Cloudflare global network to the Internet:\nflowchart TB\n    %% Accessibility\n    accTitle: Gateway order of enforcement\n    accDescr: Flowchart describing the order of enforcement for Gateway policies.\n\n    %% In with user traffic\n    start([\"Traffic\"])-->dns0[/\"DNS query\"/]-->dns1\n    start-->http0{{\"HTTP(S) request on port 80 or 443?\"}}\n    http0--Yes-->http1\n    http0--No-->network0\n\n    %% DNS policies\n    subgraph DNS\n    dns1[\"DNS policies\"]\n    style DNS text-align:left\n    dns1--Resolved by-->dns2[\"1.1.1.1\"]\n    dns1-.->dns3\n\n        %% DNS resolution\n        subgraph Resolution\n        dns2[\"1.1.1.1\"]\n        dns3[\"Resolver policies <br />(Enterprise users only)\"]--Resolved by-->dns4[\"Custom resolver\"]\n        end\n\n    end\n    dns2[\"1.1.1.1\"]----->internet\n    dns4----->internet\n    dns4-.->cloudflare[\"Private network services <br />(Cloudflare Tunnel, Magic WAN, etc.)\"]\n\n\n    %% Proxied by Gateway\n    subgraph Proxy\n\n    %% HTTP policies\n    subgraph HTTP\n    http1{{\"Do Not Inspect policies\"}}\n    http1-.\"Inspect\".->http2[\"Isolate policies  <br />(with add-on)\"]\n    http2-->http3[\"Allow, Block, Do Not Scan policies\"]\n    end\n\n    http1--Do Not Inspect-->network0\n    http3-->network0\n    network0[/\"Network connections\"/]-->network1\n\n    %% Network policies\n    subgraph Network\n    network1[\"Network policies\"]\n    end\n    end\n\n    %% Egress\n    subgraph Egress\n    network1-.->egress1[\"Egress policies <br />(Enterprise users only)\"]\n    end\n\n    %% Finish\n    network1--Egress with Cloudflare IP-->internet([Internet])\n    egress1--Egress with dedicated IP-->internet\n\nPriority between policy builders\nGateway applies your policies in the following order:\n\nDNS policies with selectors evaluated before resolution\nDNS policies with selectors evaluated after resolution\nHTTP policies\nNetwork policies\nEgress policies (if applicable)\n\nDNS policies are standalone. For example, if you block a site with a DNS policy but do not create a corresponding HTTP policy, users can still access the site if they know its IP address.\nNext, Gateway evaluates HTTP policies in a specific order. For example, if you block a specific source IP in an HTTP policy but allow the IP range in a network policy, the IP address will be blocked.\nLastly, if traffic passes your HTTP policies, Gateway checks the traffic against your network policies. For example, even if you create a Do Not Inspect HTTP policy for a site, it can be blocked by a subsequent network policy.\nHTTP/3 traffic\nFor proxied HTTP/3 traffic, Gateway applies your policies in the following order:\n\nDNS policies\nNetwork policies\nHTTP policies\n\nPriority within a policy builder\nDNS policies\nGateway evaluates DNS policies first in order of DNS resolution, then in order of precedence.\nWhen DNS queries are received, Gateway evaluates policies with pre-resolution selectors, resolves the DNS query, then evaluates policies with post-resolution selectors. This means policies with selectors evaluated before DNS resolution take precedence. For example, the following set of policies will block example.com:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPrecedenceSelectorOperatorValueAction1Resolved Country IP GeolocationisUnited StatesAllow2Domainisexample.comBlock\nDespite an explicit Allow policy ordered first, policy 2 takes precedence because the Domain selector is evaluated before DNS resolution.\nIf a policy contains both pre-resolution and post-resolution selectors, Gateway will evaluate the entire policy after DNS resolution. For information on when each selector is evaluated, refer to the list of DNS selectors.\nNetwork policies\nGateway evaluates network policies in order of precedence.\nHTTP policies\nGateway applies HTTP policies based on a combination of action type and order of precedence:\n\nAll Do Not Inspect policies are evaluated first, in order of precedence.\nIf no policies match, all Isolate policies are evaluated in order of precedence.\nAll Allow, Block and Do Not Scan policies are evaluated in order of precedence.\n\nThis order of enforcement allows Gateway to first determine whether decryption should occur. If a site matches a Do Not Inspect policy, it is automatically allowed through Gateway and bypasses all other HTTP policies.\nNoteThe only exception is if you are using Clientless Web Isolation â€” all sites within the clientless remote browser are implicitly isolated even if they match a Do Not Inspect policy.\nNext, Gateway checks decrypted traffic against your Isolate policies. When a user makes a request which triggers an Isolate policy, the request will be rerouted to a remote browser.\nLastly, Gateway evaluates all Allow, Block, and Do Not Scan policies. These policies apply to both isolated and non-isolated traffic. For example, if example.com is isolated and example.com/subpage is blocked, Gateway will block the subpage inside of the remote browser.\nOrder of precedence\nOrder of precedence refers to the priority of individual policies within the DNS, network, or HTTP policy builder (lowest value first, or from top to bottom as shown in the dashboard). You can modify the order of precedence by dragging and dropping individual policies in the dashboard.\nIn Gateway, the order of precedence follows the first match principle â€” once a site matches an Allow or Block policy, evaluation stops and no subsequent policies can override the decision. Therefore, we recommend putting the most specific policies and exceptions at the top of the list and the most general policies at the bottom.\nTerraform precedence limitationTo avoid conflicts, Terraform applies a hash calculation to precedences. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of your policies via the Cloudflare API.\nExample\nSuppose you have a list of policies arranged in the following order of precedence:\n\nDNS policies: PrecedenceSelectorOperatorValueAction1Hostisexample.comBlock2Hostistest.example.comAllow3Domainmatches regex.\\Block\nHTTP policies:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPrecedenceSelectorOperatorValueAction1Hostisexample.comBlock2Hostistest2.example.comDo Not Inspect\n\nNetwork policies:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPrecedenceSelectorOperatorValueAction1Destination Portis80Block2Destination portis443Allow3SNI Domainistest.example.comBlock\n\n\nWhen a user goes to https://test.example.com, Gateway performs the following operations:\n\n\nEvaluate DNS request against DNS policies: \nPolicy #1 does not match test.example.com â€” move on to check Policy #2.\nPolicy #2 matches, so DNS resolution is allowed.\nPolicy #3 is not evaluated because there has already been an explicit match.\n\n\n\nEvaluate HTTPS request against HTTP policies:\n\nPolicy #2 is evaluated first because Do Not Inspect always takes precedence over Allow and Block. Since there is no match, move on to check Policy #1.\nPolicy #1 does not match test.example.com. Since there are no matching Block policies, the request passes the HTTP filter and moves on to network policy evaluation.\n\n\n\nEvaluate HTTPS request against network policies:\n\nPolicy #1 does not match because port 80 is used for standard HTTP, not HTTPS.\nPolicy #2 matches, so the request is allowed and proxied to the upstream server.\nPolicy #3 is not evaluated because there has already been an explicit match.\n\n\n\nTherefore, the user is able to connect to https://test.example.com.     Was this helpful?   Yes      No        What did you like?     Accurate    Easy to understand    Solved my problem    Helped me decide to use the product    Other        What went wrong?     Hard to understand    Incorrect information    Missing the information    Other        Thank you for helping improve Cloudflare's documentation!    class r extends HTMLElement{connectedCallback(){const d={'[data-icon=\"material-symbols:thumb-up-outline-rounded\"]':\"#feedback-yes\",'[data-icon=\"material-symbols:thumb-down-outline-rounded\"]':\"#feedback-no\"},s=this.querySelector(\"#feedback-thumbs\"),o=this.querySelector(\"#feedback-thanks\");if(!(!s||!o))for(const[i,n]of Object.entries(d))this.querySelector(i)?.addEventListener(\"click\",()=>{s.classList.add(\"hidden\");const e=this.querySelector(n);if(!e)return;e.classList.remove(\"hidden\");const a=e.querySelector(\"form\");a&&a.addEventListener(\"submit\",async c=>{c.preventDefault();const t=new FormData(c.target);t.set(\"page\",window.location.pathname),t.set(\"option\",n.split(\"-\")[1]),fetch(\"https://feedback.developers.cloudflare.com\",{method:\"POST\",body:t}),e.classList.add(\"hidden\"),o.classList.remove(\"hidden\")})})}}customElements.define(\"feedback-prompt\",r);       Edit page          Cloudflare DashboardDiscordCommunityLearning CenterSupport Portal\n\t\t\t\tfunction OptanonWrapper() {}\n\t\t\t  Cookie Settings",
  "custom_id": "g8cd48mA6tuCgNcfwLbNMqLsEMEqAId48iyFGpS0r1kClufnTYc7clipWiglmdJ1"
}